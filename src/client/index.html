<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Life simulation</title>

		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
		<script type="text/javascript" charset="utf-8">
			// init connection and retrieve main map
			var BASE_URL = 'http://127.0.0.1:10001/';
			var socket = io.connect(BASE_URL);
			socket.on('connect', function(data) {
				socket.emit('message', {counter: 1})

				socket.on('message', function(data){
					console.log(data);
				});
			});
		</script>

	</head>

	<body>
		<!-- <p>Hello world</p> -->
		<canvas id="canvas"></canvas>
	</body>

	<script type="text/javascript">
		// retrieve main map

		function makeRequest(endpoint){
			var xhr = new XMLHttpRequest();
			xhr.open('GET', BASE_URL + endpoint, false)
			xhr.send();
			return JSON.parse(xhr.responseText);
		}

		var mainWorld = makeRequest('get_example_world');
		var colorPalette = makeRequest('get_settings');

		// init canvas
		var canvas = document.getElementById('canvas');
		var ctx = canvas.getContext('2d');
		var w = canvas.width = window.innerWidth;
		var h = canvas.height = window.innerHeight;

		var cellSize = 5;

		console.log(mainWorld[0]);

		function componentToHex(c) {
			var hex = c.toString(16);
			return hex.length == 1 ? "0" + hex : hex;
		}

		function rgbToHex(rgb) {
			return "#" + componentToHex(rgb[0]) + componentToHex(rgb[1]) + componentToHex(rgb[2]);
		}

		function drawWorld(){
			ctx.clearRect(0,0, w,h);
			for(var y in mainWorld){
				for(var x in mainWorld[y]){
					ctx.beginPath();
					ctx.rect(x * cellSize, y * cellSize, cellSize, cellSize);
					let blockName = colorPalette['BLOCKS']['INDEX_BLOCKS'][mainWorld[y][x]];
					let blockColor = rgbToHex(colorPalette['BLOCKS'][blockName]);

					ctx.fillStyle = blockColor;
					ctx.fill();
				}
			}
		}

		function loop(){
			drawWorld();
		}

		loop();
		// setInterval(function(){loop();}, 16);

	</script>


</html>